/*!
 * easyGeoLocation
 * @author qinjieyou
 * @version	1.0, 2012-06-04
 * @learn more:https://github.com/jieyou/easyGeoLocation
 */
(function(d){var f,l=navigator.geolocation,k=null,a={},g,h=function(o,m){var n=this;if(m){n.states=0;n.timestamp=o.timestamp;n.location={accuracy:o.coords.accuracy,point:{latitude:o.coords.latitude,longitude:o.coords.longitude}};n.speed=o.coords.speed;n.heading=o.coords.heading}else{n.states=o.code;n.timestamp=n.location=n.speed=n.heading=null}},c=function(m,n){if((typeof(m)!=="function")||(!n&&f!==0&&f!==d)){return}if(n&&f!==d){m(f);return}if(l){l.getCurrentPosition(function(o){if(n){f=0;m(f)}else{m(new h(o,true))}},function(o){if(n){if(o.code===1){f=1}else{f=0}m(f)}else{m(new h(o,false))}},(n?{enableHighAccuracy:false}:g))}else{if(n){f=10;m(f)}}},b=function(n){var m=a;if(n||(m.watchLocationCallback===d&&m.getSpeedCallback===d&&m.watchSpeedCallback===d&&m.getHeadingCallback===d&&m.watchHeadingCallback===d)){l.clearWatch(k);k=null}},e=function(n,m,o,p){if((f!==0&&f!==d)||!l){return}var r,q;switch(n){case"location":q="clearWatchLocation";r="watchLocationCallback";break;case"speed":q="clearWatchSpeed";r=o?"getSpeedCallback":"watchSpeedCallback";break;case"heading":q="clearWatchHeading";r=o?"getHeadingCallback":"watchHeadingCallback";break;default:return;break}a[r]=o?(function(s){if(s.states===0&&(n==="location"?(s[n].point.latitude&&s[n].point.longitude):s[n])){m(s);delete a[r];b()}}):(function(s){if(s.states===0&&(n==="location"?(s[n].point.latitude&&s[n].point.longitude):s[n])){m(s)}});j();if(typeof(p)==="number"){setTimeout(function(){i[q]()},p)}},j=function(){if(!k){k=l.watchPosition(function(o){var m=new h(o,true),n;for(n in a){a[n](m)}},function(o){var m=new h(o,false),n;for(n in a){a[n](m)}},g)}},i={setConfig:function(m){config=m;if(k){b(true);j()}},getAvailableCode:function(m){if(typeof(m)==="function"){c(m,true)}return i},getLocation:function(m){if(typeof(m)==="function"&&l){c(m,false)}return i},watchLocation:function(m,n){if(typeof(m)==="function"&&l){e("location",m,false,n)}return i},clearWatchLocation:function(){if(l){delete a.watchLocationCallback;b()}return i},getSpeed:function(m){if(typeof(m)==="function"&&l){e("speed",m,true)}return i},stopGetSpeed:function(){if(l){delete a.getSpeedCallback;b()}return this},watchSpeed:function(m,n){if(typeof(m)==="function"&&l){e("speed",m,false,n)}return i},clearWatchSpeed:function(){if(l){delete a.watchSpeedCallback;b()}return i},getHeading:function(m){if(typeof(m)==="function"&&l){e("heading",m,true)}return i},stopGetHeading:function(){if(l){delete a.getHeadingCallback;b()}return this},watchHeading:function(m,n){if(typeof(m)==="function"&&l){e("heading",m,false,n)}return i},clearWatchHeading:function(){if(l){delete a.watchHeadingCallback;b()}return i},clearWatch:function(){if(l&&k){delete a.watchSpeedCallback;delete a.watchHeadingCallback;delete a.watchLocationCallback;b()}return i},clearAll:function(){if(l&&k){delete a.watchSpeedCallback;delete a.watchHeadingCallback;delete a.watchLocationCallback;delete a.getSpeedCallback;delete a.getHeadingCallback;b(true)}return i}};window.easyGeoLocation=i})();